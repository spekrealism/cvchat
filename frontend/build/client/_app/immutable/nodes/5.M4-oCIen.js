import{t as _,a as w}from"../chunks/qhCaCgHc.js";import{i as M}from"../chunks/8bq-mjS9.js";import{ab as O,ac as q,j as o,m as u,af as l,ad as r,b as t,ae as i,ah as A,ag as P,d as F}from"../chunks/CnglX5le.js";import{s as g,e as J}from"../chunks/8PFJ6ntA.js";import{i as C}from"../chunks/Dy2_i3Fl.js";import{r as N}from"../chunks/BY3XG9Md.js";import{b as z}from"../chunks/ClStUPh4.js";import{o as B}from"../chunks/BqiK9gpZ.js";var G=_('<div class="success-message svelte-b0xw87"><h2 class="svelte-b0xw87">Устройство успешно подключено!</h2> <div class="device-info svelte-b0xw87"><p class="svelte-b0xw87"><strong>Имя устройства:</strong> </p> <p class="svelte-b0xw87"><strong>Последнее подключение:</strong> </p></div> <p>Перенаправление на страницу профиля...</p></div>'),H=_('<div class="error-message svelte-b0xw87"> </div>'),K=_('<div class="connect-form"><p class="instruction svelte-b0xw87">Введите код подключения, чтобы добавить это устройство к вашему профилю</p> <div class="input-group svelte-b0xw87"><input type="text" placeholder="Введите код подключения" class="svelte-b0xw87"> <button class="connect-button svelte-b0xw87"> </button></div> <!></div>'),Q=_('<div class="connect-container svelte-b0xw87"><h1 class="svelte-b0xw87">Подключение устройства</h1> <!></div>');function se(D,T){O(T,!1);let v=u(""),m=u(!1),p=u(""),n=u(null),S=u(!1);const U="http://localhost:3001/api",j=async()=>{if(!t(v)){o(p,"Введите код подключения");return}try{o(m,!0),o(p,"");const e=await fetch(`${U}/devices/connect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({connectionCode:t(v)})}),a=await e.json();if(!e.ok)throw new Error(a.message||"Не удалось подключить устройство");o(n,a),o(S,!0),t(n)&&t(n).userId&&(localStorage.setItem("userId",t(n).userId),setTimeout(()=>{window.location.href=`/profile/${t(n).userId}`},3e3))}catch(e){console.error("Ошибка подключения:",e),o(p,e instanceof Error?e.message:"Произошла ошибка при подключении")}finally{o(m,!1)}},k=e=>{const a=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)};B(()=>{const e=localStorage.getItem("userId");e&&(window.location.href=`/profile/${e}`);const s=new URLSearchParams(window.location.search).get("code");s&&o(v,s)}),M();var h=Q(),R=l(r(h),2);{var $=e=>{var a=G(),s=l(r(a),2),c=r(s),d=l(r(c));i(c);var b=l(c,2),x=l(r(b));i(b),i(s),A(2),i(a),P(I=>{g(d,` ${t(n).name??""}`),g(x,` ${I??""}`)},[()=>k(t(n).lastConnected)],F),w(e,a)},E=e=>{var a=K(),s=l(r(a),2),c=r(s);N(c);var d=l(c,2),b=r(d,!0);i(d),i(s);var x=l(s,2);{var I=f=>{var y=H(),L=r(y,!0);i(y),P(()=>g(L,t(p))),w(f,y)};C(x,f=>{t(p)&&f(I)})}i(a),P(()=>{c.disabled=t(m),d.disabled=t(m)||!t(v),g(b,t(m)?"Подключение...":"Подключить")}),z(c,()=>t(v),f=>o(v,f)),J("click",d,j),w(e,a)};C(R,e=>{t(S)&&t(n)?e($):e(E,!1)})}i(h),w(D,h),q()}export{se as component};

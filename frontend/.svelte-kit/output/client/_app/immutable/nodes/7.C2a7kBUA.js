import{b as ee,d as be,t as y,a as _,c as ye}from"../chunks/qhCaCgHc.js";import{i as ne}from"../chunks/8bq-mjS9.js";import{y as Te,t as te,x as ae,E as je,B as se,Z as xe,aD as ke,aE as Me,o as Ce,v as Se,X as Re,ab as le,ad as v,b as e,m as p,j as n,af as g,ae as d,ag as N,d as re,ac as ce,aa as Ie}from"../chunks/CnglX5le.js";import{e as O,s as Z}from"../chunks/8PFJ6ntA.js";import{i as B}from"../chunks/Dy2_i3Fl.js";import{e as $e,i as Ee}from"../chunks/DEaYwLy0.js";import{r as de}from"../chunks/BY3XG9Md.js";import{s as z}from"../chunks/DiTW7_4n.js";import{t as ie,f as oe}from"../chunks/D7ZupLfI.js";import{b as ve}from"../chunks/ClStUPh4.js";import{o as ue}from"../chunks/BqiK9gpZ.js";import{b as Le}from"../chunks/BCt3m0Z-.js";import{p as Ve}from"../chunks/reZitHEr.js";function De(V,S,D,r,s){var h=V,u="",l;Te(()=>{if(u===(u=S()??"")){te&&ae();return}l!==void 0&&(Re(l),l=void 0),u!==""&&(l=je(()=>{if(te){se.data;for(var i=ae(),w=i;i!==null&&(i.nodeType!==8||i.data!=="");)w=i,i=xe(i);if(i===null)throw ke(),Me;ee(se,w),h=Ce(i);return}var f=u+"",T=be(f);ee(Se(T),T.lastChild),h.before(T)}))})}var He=y("<div> </div>"),Ae=y('<div class="captcha-container svelte-19i9ba5"><canvas width="200" height="70" class="svelte-19i9ba5"></canvas> <div><input type="text" placeholder="Введите текст с картинки" class="svelte-19i9ba5"> <div class="buttons svelte-19i9ba5"><button type="button" class="svelte-19i9ba5">Проверить</button> <button type="button" class="svelte-19i9ba5">Обновить</button></div></div> <!></div>');function Pe(V,S){le(S,!1);let D=Ve(S,"onVerified",8,()=>{}),r=p(),s,h="",u=p(""),l=p(!1),i=p("");const w=()=>{const a="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";return a.charAt(Math.floor(Math.random()*a.length))},f=()=>{if(e(r)&&(s=e(r).getContext("2d"),!!s)){h="",s.clearRect(0,0,e(r).width,e(r).height),s.fillStyle="#f0f0f0",s.fillRect(0,0,e(r).width,e(r).height);for(let a=0;a<6;a++){const m=w();h+=m,s.font="24px Arial",s.fillStyle=`rgb(${Math.random()*100}, ${Math.random()*100}, ${Math.random()*100})`;const j=20+a*25,b=25+Math.random()*10,P=(Math.random()-.5)*.5;s.save(),s.translate(j,b),s.rotate(P),s.fillText(m,0,0),s.restore()}for(let a=0;a<5;a++)s.beginPath(),s.moveTo(Math.random()*e(r).width,Math.random()*e(r).height),s.lineTo(Math.random()*e(r).width,Math.random()*e(r).height),s.strokeStyle=`rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.5)`,s.stroke()}},T=()=>{e(u).toLowerCase()===h.toLowerCase()?(n(l,!0),n(i,"Проверка пройдена!"),D()(!0)):(n(i,"Неверно! Попробуйте еще раз."),f(),n(u,""))},o=()=>{n(u,""),n(i,""),f()};ue(()=>{f()}),ne();var R=Ae(),U=v(R);Le(U,a=>n(r,a),()=>e(r));var I=g(U,2);let F;var $=v(I);de($);var H=g($,2),A=v(H),J=g(A,2);d(H),d(I);var t=g(I,2);{var c=a=>{var m=He();let j;var b=v(m,!0);d(m),N(P=>{j=z(m,1,"message svelte-19i9ba5",null,j,P),Z(b,e(i))},[()=>({success:e(l)})],re),_(a,m)};B(t,a=>{e(i)&&a(c)})}d(R),N(a=>{F=z(I,1,"captcha-controls svelte-19i9ba5",null,F,a),$.disabled=e(l),A.disabled=e(l),J.disabled=e(l)},[()=>({hidden:e(l)})],re),ve($,()=>e(u),a=>n(u,a)),O("click",A,T),O("click",J,o),_(V,R),ce()}var qe=y('<div class="captcha-wrapper svelte-1tp95wj"><!></div>'),Be=y('<div class="register-btn-wrapper svelte-1tp95wj"><button class="register-button svelte-1tp95wj"> </button></div>'),Ne=y('<div class="html-content svelte-1tp95wj"><!> <!> <!></div>'),Oe=y('<p class="svelte-1tp95wj"> </p>'),Ue=y('<div><div class="message-content svelte-1tp95wj"><!> <span class="message-time svelte-1tp95wj"> </span></div></div>'),Fe=y('<main class="svelte-1tp95wj"><div class="chat-container svelte-1tp95wj"><header class="chat-header svelte-1tp95wj"><a href="/" class="back-button svelte-1tp95wj" aria-label="Вернуться на главную"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg></a> <h1 class="svelte-1tp95wj">Регистрация</h1></header> <div class="messages-container svelte-1tp95wj"></div> <div class="message-input svelte-1tp95wj"><input type="text" placeholder="Введите сообщение..." class="svelte-1tp95wj"> <button aria-label="Отправить сообщение" class="svelte-1tp95wj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1tp95wj"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div></div></main>');function rt(V,S){le(S,!1);let D=p(!1),r=p([]),s=p(""),h="",u=p(!1),l=p(!1),i=p(!1),w=!1,f="";const T="http://localhost:3001/api";ue(()=>{n(D,!0);const t=localStorage.getItem("userId");if(t){window.location.href=`/profile/${t}`;return}setTimeout(()=>{o("Привет!"),setTimeout(()=>{o(`Я помогу вам зарегистрироваться на нашей платформе. 
        Для регистрации нам понадобится только ваше имя.
        
        Обратите внимание, что регистрируясь на нашем сайте, вы соглашаетесь с условиями обработки персональных данных в соответствии с действующим законодательством.`),setTimeout(()=>{o('Напишите "да", если согласны продолжить регистрацию.'),w=!0},1500)},500)},300)});function o(t,c=!1){n(r,[...e(r),{text:t,sender:"system",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),isHtml:c}]),setTimeout(()=>{const a=document.querySelector(".messages-container");a&&(a.scrollTop=a.scrollHeight)},100)}function R(){if(e(s).trim()==="")return;const t=e(s).trim();n(r,[...e(r),{text:t,sender:"user",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),n(s,""),setTimeout(()=>{const c=document.querySelector(".messages-container");c&&(c.scrollTop=c.scrollHeight)},100),w?U(t):h===""&&I(t)}function U(t){w=!1,t.toLowerCase()==="да"?setTimeout(()=>{o("Отлично! Теперь введите, пожалуйста, ваше имя:")},1e3):setTimeout(()=>{o('К сожалению, без вашего согласия мы не можем продолжить регистрацию. Напишите "да", если хотите продолжить.'),w=!0},1e3)}function I(t){h=t,setTimeout(()=>{o(`Спасибо, ${h}! Для завершения регистрации, пожалуйста, подтвердите, что вы человек.`),setTimeout(()=>{n(i,!0),o('<div class="captcha-container"></div>',!0)},1e3)},1e3)}const F=t=>{n(u,t),t&&setTimeout(()=>{o("Отлично! Теперь вы можете завершить регистрацию."),setTimeout(()=>{o('<button class="register-button">Завершить регистрацию</button>',!0)},1e3)},1e3)},$=async()=>{if(!h){o("Пожалуйста, введите ваше имя перед регистрацией.");return}if(!e(u)){o("Пожалуйста, пройдите проверку перед регистрацией.");return}try{n(l,!0),o("Регистрация...");const t=await fetch(`${T}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h})}),c=await t.json();if(!t.ok)throw new Error(c.message||"Ошибка регистрации");f=c.id,localStorage.setItem("userId",f),o(`Регистрация успешна! Ваш ID: ${f}`),setTimeout(()=>{o("Перенаправление на страницу профиля..."),setTimeout(()=>{window.location.href=`/profile/${f}`},2e3)},1500)}catch(t){console.error("Ошибка:",t),t instanceof Error?o(`Ошибка: ${t.message||"Произошла ошибка при регистрации"}`):o("Произошла неизвестная ошибка при регистрации")}finally{n(l,!1)}};ne();var H=ye(),A=Ie(H);{var J=t=>{var c=Fe(),a=v(c),m=g(v(a),2);$e(m,5,()=>e(r),Ee,(q,x)=>{var X=Ue(),G=v(X),K=v(G);{var he=E=>{var k=Ne(),Y=v(k);De(Y,()=>e(x).text);var W=g(Y,2);{var pe=M=>{var C=qe(),L=v(C);Pe(L,{onVerified:F}),d(C),_(M,C)};B(W,M=>{e(x).text.includes("captcha-container")&&e(i)&&M(pe)})}var ge=g(W,2);{var we=M=>{var C=Be(),L=v(C),_e=v(L,!0);d(L),d(C),N(()=>{L.disabled=e(l)||!e(u),Z(_e,e(l)?"Регистрация...":"Завершить регистрацию")}),O("click",L,$),_(M,C)};B(ge,M=>{e(x).text.includes("register-button")&&M(we)})}d(k),_(E,k)},me=E=>{var k=Oe(),Y=v(k,!0);d(k),N(()=>Z(Y,e(x).text)),_(E,k)};B(K,E=>{e(x).isHtml?E(he):E(me,!1)})}var Q=g(K,2),fe=v(Q,!0);d(Q),d(G),d(X),N(()=>{z(X,1,`message ${(e(x).sender==="user"?"user-message":"system-message")??""}`,"svelte-1tp95wj"),Z(fe,e(x).time)}),_(q,X)}),d(m);var j=g(m,2),b=v(j);de(b);var P=g(b,2);d(j),d(a),d(c),ve(b,()=>e(s),q=>n(s,q)),O("keydown",b,q=>q.key==="Enter"&&R()),O("click",P,R),ie(1,c,()=>oe,()=>({x:-1e3,duration:500})),ie(2,c,()=>oe,()=>({x:1e3,duration:500})),_(t,c)};B(A,t=>{e(D)&&t(J)})}_(V,H),ce()}export{rt as component};

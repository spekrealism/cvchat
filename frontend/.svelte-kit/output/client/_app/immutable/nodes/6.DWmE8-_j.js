import{c as Ce,a as f,t as h}from"../chunks/qhCaCgHc.js";import{i as je}from"../chunks/8bq-mjS9.js";import{ab as Se,aa as Te,ac as Ee,b as t,m as p,j as r,ad as a,ae as s,af as l,ag as S,d as te}from"../chunks/CnglX5le.js";import{s as d,e as T}from"../chunks/8PFJ6ntA.js";import{i as E}from"../chunks/Dy2_i3Fl.js";import{e as Oe,i as Pe}from"../chunks/DEaYwLy0.js";import{r as Ue}from"../chunks/BY3XG9Md.js";import{b as Ae}from"../chunks/ClStUPh4.js";import{p as Me}from"../chunks/reZitHEr.js";import{o as Ne}from"../chunks/BqiK9gpZ.js";const Re=({params:P})=>({userId:P.userId}),as=Object.freeze(Object.defineProperty({__proto__:null,load:Re},Symbol.toStringTag,{value:"Module"}));var qe=h('<div class="loading svelte-1klhsf2"><p>Загрузка профиля...</p></div>'),ze=h('<div class="error-container svelte-1klhsf2"><p class="error-message svelte-1klhsf2"> </p> <button>Попробовать снова</button></div>'),Fe=h('<div class="device-card svelte-1klhsf2"><div class="device-info"><h3 class="svelte-1klhsf2"> </h3> <p class="svelte-1klhsf2"> </p> <p class="svelte-1klhsf2"> </p></div></div>'),Je=h('<div class="devices-list svelte-1klhsf2"></div>'),Le=h('<p class="no-devices svelte-1klhsf2">У вас пока нет подключенных устройств.</p>'),Be=h('<div class="connection-code-container svelte-1klhsf2"><p>Код подключения для нового устройства:</p> <div class="code-display svelte-1klhsf2"><span class="code svelte-1klhsf2"> </span> <button class="copy-button svelte-1klhsf2">Копировать</button></div> <p class="code-instruction svelte-1klhsf2">Используйте этот код для подключения устройства через страницу подключения</p> <button class="button svelte-1klhsf2">Ок</button></div>'),Ge=h('<div class="add-device-form svelte-1klhsf2"><input type="text" placeholder="Название устройства" class="svelte-1klhsf2"> <button class="button svelte-1klhsf2"> </button></div>'),He=h('<div class="profile-container svelte-1klhsf2"><div class="profile-header svelte-1klhsf2"><h1 class="svelte-1klhsf2">Профиль пользователя</h1> <button class="logout-button svelte-1klhsf2">Выйти</button></div> <div class="profile-info"><div class="info-card svelte-1klhsf2"><h2 class="svelte-1klhsf2">Информация</h2> <div class="info-row svelte-1klhsf2"><span class="label svelte-1klhsf2">Имя:</span> <span class="value svelte-1klhsf2"> </span></div> <div class="info-row svelte-1klhsf2"><span class="label svelte-1klhsf2">ID:</span> <span class="value svelte-1klhsf2"> </span></div> <div class="info-row svelte-1klhsf2"><span class="label svelte-1klhsf2">Баланс:</span> <span class="value svelte-1klhsf2"> </span></div> <div class="info-row svelte-1klhsf2"><span class="label svelte-1klhsf2">Дата регистрации:</span> <span class="value svelte-1klhsf2"> </span></div></div></div> <div class="devices-section svelte-1klhsf2"><h2 class="svelte-1klhsf2">Устройства</h2> <!> <div class="add-device-section svelte-1klhsf2"><h3 class="svelte-1klhsf2">Добавить новое устройство</h3> <!></div></div></div>');function ts(P,L){Se(L,!1);let U=Me(L,"data",8),A=p(!0),g=p(""),_=p(null),w=p([]),m=p(""),y=p(!1),O=p(""),M=p(!1);const B="http://localhost:3001/api",G=async()=>{try{r(A,!0),r(g,"");const e=await fetch(`${B}/users/${U().userId}`),v=await e.json();if(!e.ok)throw new Error(v.message||"Не удалось загрузить профиль");r(_,v),r(w,v.Devices||[])}catch(e){console.error("Ошибка загрузки профиля:",e),r(g,e instanceof Error?e.message:"Произошла ошибка при загрузке профиля")}finally{r(A,!1)}},le=async()=>{if(t(m))try{r(y,!0);const e=await fetch(`${B}/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t(m),userId:U().userId})}),v=await e.json();if(!e.ok)throw new Error(v.message||"Не удалось добавить устройство");r(O,v.connectionCode),r(M,!0),r(w,[...t(w),v]),r(m,"")}catch(e){console.error("Ошибка добавления устройства:",e),r(g,e instanceof Error?e.message:"Произошла ошибка при добавлении устройства")}finally{r(y,!1)}},re=()=>{navigator.clipboard.writeText(t(O)).then(()=>{alert("Код скопирован!")}).catch(e=>{console.error("Не удалось скопировать: ",e)})},H=e=>{const v=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(v)},oe=()=>{localStorage.removeItem("userId"),window.location.href="/register"};Ne(()=>{const e=localStorage.getItem("userId");if(!e||e!==U().userId){window.location.href="/register";return}G()}),je();var K=Ce(),ve=Te(K);{var ie=e=>{var v=qe();f(e,v)},ne=(e,v)=>{{var ce=k=>{var x=ze(),I=a(x),D=a(I,!0);s(I);var C=l(I,2);s(x),S(()=>d(D,t(g))),T("click",C,G),f(k,x)},de=(k,x)=>{{var I=D=>{var C=He(),N=a(C),fe=l(a(N),2);s(N);var R=l(N,2),Q=a(R),q=l(a(Q),2),V=l(a(q),2),pe=a(V,!0);s(V),s(q);var z=l(q,2),W=l(a(z),2),he=a(W,!0);s(W),s(z);var F=l(z,2),X=l(a(F),2),ue=a(X);s(X),s(F);var Y=l(F,2),Z=l(a(Y),2),_e=a(Z,!0);s(Z),s(Y),s(Q),s(R);var $=l(R,2),ee=l(a($),2);{var me=o=>{var i=Je();Oe(i,5,()=>t(w),Pe,(c,n)=>{var u=Fe(),b=a(u),j=a(b),ye=a(j,!0);s(j);var J=l(j,2),xe=a(J);s(J);var ae=l(J,2),Ie=a(ae);s(ae),s(b),s(u),S(De=>{d(ye,t(n).name),d(xe,`ID: ${t(n).id??""}`),d(Ie,`Последнее подключение: ${De??""}`)},[()=>H(t(n).lastConnected)],te),f(c,u)}),s(i),f(o,i)},ke=o=>{var i=Le();f(o,i)};E(ee,o=>{t(w).length>0?o(me):o(ke,!1)})}var se=l(ee,2),be=l(a(se),2);{var ge=o=>{var i=Be(),c=l(a(i),2),n=a(c),u=a(n,!0);s(n);var b=l(n,2);s(c);var j=l(c,4);s(i),S(()=>d(u,t(O))),T("click",b,re),T("click",j,()=>{r(M,!1),r(O,"")}),f(o,i)},we=o=>{var i=Ge(),c=a(i);Ue(c);var n=l(c,2),u=a(n,!0);s(n),s(i),S(()=>{c.disabled=t(y),n.disabled=!t(m)||t(y),d(u,t(y)?"Добавление...":"Добавить устройство")}),Ae(c,()=>t(m),b=>r(m,b)),T("click",n,le),f(o,i)};E(be,o=>{t(M)?o(ge):o(we,!1)})}s(se),s($),s(C),S(o=>{d(pe,t(_).name),d(he,t(_).id),d(ue,`${t(_).balance??""} ₽`),d(_e,o)},[()=>H(t(_).createdAt)],te),T("click",fe,oe),f(D,C)};E(k,D=>{t(_)&&D(I)},x)}};E(e,k=>{t(g)?k(ce):k(de,!1)},v)}};E(ve,e=>{t(A)?e(ie):e(ne,!1)})}f(P,K),Ee()}export{ts as component,as as universal};
